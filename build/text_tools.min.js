!function(){"use strict";function e(e){return Array.isArray(e)||(e=[...arguments]),e[Math.floor(Math.random()*e.length)]}function t(e){return Math.random(1)<e}if("undefined"!=typeof module&&(module.exports={coinFlip:function(){return Math.random()>.5},choice:e,chance:t}),"undefined"!=typeof module){const{coinFlip:e,choice:t,chance:n}=require("./cool.js"),{Markov:r}=require("./Markov.js")}function r(n){n||(n={});let{cfgFiles:r,tagChance:o,filterChance:s,removeChance:l,callback:c}=n,u={},f={},a={},h=void 0===n.shareOverrides||n.shareOverrides,d={n:3,max:13},p=(n.defaultSentenceType,n.useMarkov||!1),g=o||.5,y=s||.5,m=l||.5,b={},O={};function j(t,n,r,i,o,s){if(i[n]&&i[n].length>0){let s=e(i[n]);if(Array.isArray(s))for(let e=0;e<s.length;e++)j(t,s[e],r,i,o,n);else"@&"===n&&console.log("@&",s),r.push({word:s,pos:n}),i[n].splice(i[n].indexOf(s),1);return r}if(u[t][n]){let s,l=o[n]?u[t][n].filter((e=>e.includes(o[n]))):u[t][n];s=0===l.length?e(u[t][n]):e(l);for(let e=0;e<s.length;e++)j(t,s[e],r,i,o,n)}else{let e=n,t=s;if("@&"===n&&(e=r[r.length-1].word),"@"===n[0]){t=n.substring(1);for(let n=r.length-1;n>=0;n--)if(r[n].pos===t){e=r[n].word;break}}r.push({word:e,pos:t})}return r}function w(e){let t=e.map((e=>e.word)).join(" ");t=t.replace(/\s+(?=[.?!,â€”])/g,""),t=t.replace(/\ba (?=[aeiou])/gi,"an "),t=t.replace(/\ban (?![aeiou])/gi,"a "),t=t.replace(/\bi\b/g,"I"),t=t.replace(/\s\'s'/g,"'s"),t=t[0].toUpperCase()+t.substring(1,t.length);let n=t.match(/[\.\?\!]\s[a-z]/g);return n&&n.forEach((e=>{let n=e.substring(0,e.length-1)+e[e.length-1].toUpperCase();t=t.replace(e,n)})),t}this.isReady=!1,r&&Object.keys(r).length>0&&async function(){for(const e in r){const t=r[e],n=await fetch(t).then((e=>e.json()));this.feed(e,n)}}(),this.feed=function(e,n){a[e]||(a[e]={}),u[e]||(u[e]={}),f[e]||(f[e]={});for(const t in n)if(u[e][t]=n[t],p&&"SQEF".includes(t)){f[e][t]=new i(d);for(let r=0;r<n[t].length;r++){let i=[...n[t][r]];i.pop(),f[e][t].feed(i.join(" "))}}b[e]||(b[e]=[]),O[e]||(O[e]=[]),b[e]=b[e].concat(Object.keys(u[e]).filter((e=>e.length>1))),O[e]=O[e].concat(b[e].filter((e=>t(y)))),!this.isReady&&Object.keys(u[e]).length>0&&(this.isReady=!0,c&&c())},this.addOverrides=function(e,n,r){a[e]||(a[e]={},b[e]=Object.keys(u[e]).filter((e=>e.length>1)),O[e]=b[e].filter((e=>t(y))));const i=h?Object.keys(u):[e];for(let e=0;e<i.length;e++){const o=i[e];for(let e=0;e<n.length-1;e++){if(!t(r||0))continue;const{pos:i,word:s}=n[e];O[o].includes(i)&&(a[o][i]||(a[o][i]=[]),a[o][i].includes(s)||a[o][i].push(s))}}},this.updateOverrides=function(n,r){for(const e in a[n])t(r)&&a[n][e].shift();t(r)&&O[n].shift(),t(r)&&O[n].push(e(b[n].filter((e=>!O[n].includes(e)))))},this.clearOverrides=function(){for(const e in a)a[e]={}},this.getSentence=function(e,t,n,r){let i={...a[e]};p&&(i[t]=[[...f[e][t].getSequence().split(" "),"."]]);let o=this.getText(e,t,i,r);return n&&(this.addOverrides(e,o.tags,g),this.updateOverrides(e,m)),o.text},this.getText=function(e,t,n,r){"string"==typeof n&&(n=JSON.parse(n)),n[t]||(u[e][t]||(t="S"),u[e][t].length||(t="S"));let i=j(e,t,[],n||{},r||{});return{text:w(i),tags:i}}}if("undefined"!=typeof module&&(module.exports={CFGGenerator:r}),"undefined"!=typeof window&&(window.CFGGenerator=r),"undefined"!=typeof module){const{coinFlip:e,choice:t,chance:n}=require("./cool.js")}function i(t){n=Number(t.n),max=Number(t.max);let r={},i=[];function o(e){return e.split(/\s+/)}this.feed=function(e){let t=o(e);if(t.length<n)return!1;let s=t.slice(0,n).join(" ");i.push(s);for(let e=0;e<t.length-n;e++){let i,o;i=t.slice(e,e+n).join(" "),o=t[e+n],r.hasOwnProperty(i)||(r[i]=[]),r[i].push(o)}},this.getSequence=function(){return function(){current=e(i);let t=o(current);for(let i=0;i<max&&r.hasOwnProperty(current);i++){let i=e(r[current]);t.push(i),current=t.slice(t.length-n,t.length).join(" ")}return t=t.join(" "),t}()}}"undefined"!=typeof module&&(module.exports={Markov:i})}();
//# sourceMappingURL=src_maps/text_tools.min.js.map
